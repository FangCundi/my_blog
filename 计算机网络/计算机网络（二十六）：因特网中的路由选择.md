AS内部路由选择协议用于确定在一个AS内执行路由选择的方式。AS内部路由选择协议又称为内部网关协议。历史上有两个路由选择协议曾被广泛用于因特网上自治系统内的路由选择:路由选择信息协议RIP，与开放最短路优先OSPF。


# 1、因特网中自治系统内部的路由选择：RIP

RIP是一种距离向量协议，其运行方式很像理想化DV协议。RIP版本使用跳数作为其费用测度， 每条链路的费用被定义在路由器对之间。在RIP中，费用实际上是从源路由器到目的子网RIP使用术语跳，跳是沿着从源路由器到子网(包括目的子网)的最短路径所经过的子网数量。
一条路径的最大费用被限制为15，因此RIP的使用限制在网络直径不超过15跳的自治系统内。在RIP中，路由选择更新信息在邻居之间通过使用RIP响应报文来交换，大约每30秒相互交换一次。由一台路由器或主机发出的响应报文包含了一个该AS内的多达25个目的子网的列表，以及发送方到其中每个子网的距离。响应报文又被称作RIP通告。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702231550943.png)
每台路由器维护一张称为路由选择表的RIP表。一台路由器的路由选择表包括该路由器的距离向量和该路由器的转发表。下图显示了路由器D的转发表。注意到该转发表有3列，第一列用于目的子网，第二列指示了沿着最短路径到目的子网的下一个路由器的标识，第3列指出了沿着最短路径到目的子网的跳数(即需要穿越的子网数，包括目的子网)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702231556318.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODUxNzQ0,size_16,color_FFFFFF,t_70)
**简单地讲，RIP就是DV算法在因特网使用中的具体化。通过将每个子网之间的跳转次数作为费用，来计算费用向量，并得到RIP表指导路由选择**。


# 2、困特网中自治系统内部的路由选择: OSPF

OSPF 通常都设置在上层的ISP中，而RIP却被设置在下层ISP和企业网中。OSPF的核心就是一个使用洪泛链路状态信息的链路状态协议和一个Dijkslra最低费用路径算法。
使用OSPF一台路由器构建了一幅关于整个自治系统的完整拓扑图(即一个图)。于是，路由器在本地运行Dijkstra的最短路径算法，以确定一个以自身为根结点的到所有子网的最短路径树。各条链路费用是由网络管理员配置的。管理员也许会选择将所有链路费用设为1，因而实现了最少跳数路由选择，或者可能会选择将链路权值按与链路容量成反比来设置，从而不鼓励流量使用低带宽链路。
使用OSPF时，路由器向自治系统内所有其他路由器广播路由选择信息，而不仅仅是向其相邻路由器广播。每当一条链路的状态发生变化时(如费用的变化或连接/中断状态的变化)，路由器就会广播链路状态信息。即使链路状态未发生变化，它也要周期性地(至少每隔30分钟一次)广播链路状态。
**简单地讲，OSPF是LS算法在因特网使用中的具体化。通过不断周期性的广播得到整张图的拓扑结构，然后根据dijkstra算法计算得到以路由器自身为根节点的到所有子网的最短路径**。

# 3、自治系统间的路由选择: BGP

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702231618550.png)
ISP使用RIP和OSPF来决定位于相同AS内部的源和目的对之间的优化路径。使用边界网关协议BGP来确定跨越多个AS的源和目的对之间的路径。
BGP使得每个AS知道经过其相邻AS可达哪些目的地。BGP中，目的地不是主机而是 CDIR 化的前缀，每个前缀表示一个子网或一个子网的集合。
